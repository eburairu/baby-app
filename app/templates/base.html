<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Baby-App{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',   // blue-600
                        secondary: '#16a34a', // green-600
                    }
                }
            }
        }
    </script>

    <!-- htmx -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- カスタムCSS -->
    <link rel="stylesheet" href="/static/css/custom.css">

    <script>
        // ダークモード初期化
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    {% if user %}
    {% include "components/navbar.html" %}
    {% endif %}

    <main class="{% if user %}container mx-auto px-3 md:px-4 py-4 md:py-8 pb-20 md:pb-8{% endif %}">
        {% block content %}{% endblock %}
    </main>

    <!-- トースト通知コンテナ -->
    <div id="toast-container" class="fixed bottom-20 md:bottom-5 right-5 z-50 flex flex-col gap-2"></div>

    <script>
        // ダークモード切り替え
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        // トースト表示関数
        function showToast(message, type = 'error') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : 'bg-green-500';
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transition-opacity duration-300 opacity-0`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            // アニメーション表示
            setTimeout(() => toast.classList.remove('opacity-0'), 10);
            
            // 3秒後に削除
            setTimeout(() => {
                toast.classList.add('opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // htmx エラーハンドリング
        document.body.addEventListener('htmx:responseError', function(evt) {
            const xhr = evt.detail.xhr;
            let message = 'エラーが発生しました';
            
            try {
                const response = JSON.parse(xhr.responseText);
                message = response.detail || message;
            } catch (e) {
                // JSONでない場合はステータステキストを使用
                message = `エラー: ${xhr.status} ${xhr.statusText}`;
            }
            
            showToast(message, 'error');
        });

        // 成功通知（カスタムイベント用）
        document.body.addEventListener('show-toast', function(evt) {
            showToast(evt.detail.message, evt.detail.type || 'success');
        });
    </script>

    {% block scripts %}{% endblock %}
</body>

</html>