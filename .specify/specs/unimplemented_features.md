# 不完全な機能と改善案 (Unimplemented Features & Improvements)

現状のコードベースを解析した結果、以下の不完全な箇所および改善が必要な箇所が特定されました。

## 1. 統計計算の不備 (Statistics Logic)
- **睡眠記録**: `StatisticsService.get_sleep_stats` において、継続中（`end_time` が NULL）の記録が「睡眠中」としてカウントされておらず、ダッシュボードに反映されない。
- **陣痛タイマー**: `ContractionService.get_statistics` において、完了した記録のみを対象としているため、現在進行中の陣痛が統計に含まれない。

## 2. バリデーションとエラーハンドリングの不足
- **Form データバリデーション**: `app/routers/` 内の多くのエンドポイントで、`Form` 引数を個別に受け取っており、Pydantic スキーマによる一括バリデーションが行われていない。
- **エラー通知の UX**: htmx リクエストでエラーが発生した場合、単に 400 や 404 の HTTP ステータスが返されるだけで、ユーザーには何が起きたか伝わらない。トースト通知等の仕組みが必要。

## 3. タイムゾーン対応の欠如
- サーバー側で `datetime.utcnow()` が使用されているが、クライアント側（ユーザー）のタイムゾーンを考慮した表示・保存の仕組みがない。

## 4. UI/UX の一貫性
- **削除確認**: `hx-delete` を使用している箇所で、誤操作防止のための確認ダイアログ（`hx-confirm`）が未実装。
- **ローディング表示**: 重い処理（統計計算など）の更新中に、ローディング中であることを示すインジケーターが表示されない。

## 5. テストの不足
- `tests/` ディレクトリが存在するが、主要なビジネスロジック（特に `StatisticsService` や `ContractionService`）に対するユニットテストが不十分、または存在しない。
