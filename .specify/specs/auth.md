# 認証・セキュリティ仕様書 (Authentication & Security)

ユーザー認証、招待制登録、および攻撃対策の仕様を定義します。

## 機能概要
- **招待制登録**: 第三者による勝手なアカウント作成を防止。
- **ログイン / ログアウト**: セッションベースの認証。
- **家族管理**: 家族の作成、招待コードによる他ユーザーの追加。

## 登録フロー (Security First)
1. **新規家族の作成 (First User)**:
   - システム管理者が発行する `SYSTEM_INVITE_CODE` が必要。
   - 最初のユーザーが家族名を入力し、自身を `admin` として登録。
2. **家族への参加**:
   - 既存メンバーが発行する `FAMILY_INVITE_CODE` が必要。
   - コードを入力することで特定の家族の `member` として登録。

## セキュリティ対策
- **レート制限 (Rate Limiting)**: 同一IPからの短時間での連続登録試行を制限。
- **ハニーポット (Honeypot)**: フォームに隠しフィールドを設置し、ボットを自動検知・排除。
- **パスワードハッシュ化**: `passlib` (bcrypt) を使用。
- **セッション管理**: Cookie ベースのセキュアなセッション管理。

## エンドポイント
- `GET /register`: 登録フォーム（招待コードが必要）
- `POST /register`: ユーザー登録処理（バリデーション、招待コード検証、ハニーポットチェック）
- `GET /login`: ログインフォーム
- `POST /login`: ログイン処理
- `GET /logout`: ログアウト処理

## 制約
- 招待コードがないユーザーは登録不可。
- ユーザー名はユニークである必要がある。
